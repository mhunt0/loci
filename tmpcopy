#!/bin/bash

source=`pwd`
target=${LOCI_TARGET-/usr/tmp/$LOGNAME/}

ARCH=${LOCI_ARCH-`uname -s`}

if [ $ARCH == "IRIX64" ]; then
# If IRIX OS, default to sgi compiler, otherwise default to gcc
  COMP=${LOCI_COMP-CC_sgi}
else
  COMP=${LOCI_COMP-gcc}
fi

if [ $# -eq 1 ]; then
  target=$1
fi
if [ $# -eq 2 ]; then
  target=$1
  COMP=$2
fi

TARGET_DIRS="System Tools include include/Tools include/Config include/MPI_stubb"
TOOLS_DIRS="lpp FVMtools FVMMod"

echo -n "Making Directory Structure: "
mkdir -p $target
mkdir -p $target/Loci
mkdir -p $target/Loci/lib
mkdir -p $target/Loci/bin

ln -s $source/Tutorial $target/Loci/Tutorial

for i in $TARGET_DIRS ; do
  echo -n $i " "
  mkdir -p $target/Loci/$i
done
echo

for i in $TOOLS_DIRS ; do
  echo -n $i " "
  mkdir -p $target/Loci/$i
done
echo

cd $target/Loci
if [ ! -e Makefile ]; then
  echo ln -s $source/src/Makefile Makefile
  ln -s $source/src/Makefile Makefile
fi
if [ ! -e Loci.conf ]; then
  echo ln -s $source/src/conf/Loci.conf Loci.conf
  ln -s $source/src/conf/Loci.conf Loci.conf
fi
if [ ! -e Install.bash ]; then
  echo ln -s $source/src/Install.bash Install.bash
  ln -s $source/src/Install.bash Install.bash
fi

if [ ! -e comp.conf ]; then
  echo cp $source/src/conf/${COMP}.conf comp.conf
  cp $source/src/conf/${COMP}.conf comp.conf
fi
if [ ! -e sys.conf ]; then
  echo cp $source/src/conf/${ARCH}.conf sys.conf
  cp $source/src/conf/${ARCH}.conf sys.conf
fi

cd lib
#if [ ! -e libTools.a ]; then
#  ln -s ../Tools/libTools.a libTools.a
#fi
#if [ ! -e libLoci.a ]; then
#  ln -s ../System/libLoci.a libLoci.a
#fi
if [ ! -e libTools.so ]; then
  ln -s ../Tools/libTools.so libTools.so
fi
if [ ! -e libLoci.so ]; then
  ln -s ../System/libLoci.so libLoci.so
fi
if [ ! -e fvm_m.so ]; then
  ln -s ../FVMMod/fvm_m.so fvm_m.so
fi

cd ../bin
if [ ! -e lpp ] ; then 
  ln -s ../lpp/lpp lpp
fi
if [ ! -e extract ] ; then
  ln -s ../FVMtools/extract extract
fi
if [ ! -e pb ] ; then
  ln -s ../FVMtools/pb pb
fi
if [ ! -e solidMesh2xdr ] ; then
  ln -s ../FVMtools/solidMesh2xdr solidMesh2xdr
fi
if [ ! -e solidMesh2xdrMPI ] ; then
  ln -s ../FVMtools/solidMesh2xdrMPI solidMesh2xdrMPI
fi
if [ ! -e xdr2cobalt ] ; then
  ln -s ../FVMtools/xdr2cobalt xdr2cobalt
fi
if [ ! -e cobalt2xdr ] ; then
  ln -s ../FVMtools/cobalt2xdr cobalt2xdr
fi
if [ ! -e plot3d2xdr ] ; then
  ln -s ../FVMtools/plot3d2xdr plot3d2xdr
fi
if [ ! -e xdropt ] ; then
  ln -s ../FVMtools/xdropt xdropt
fi


for dir in $TARGET_DIRS; do
  echo "Linking" $dir "directory files..."
  cd $source/src/$dir
  for i in *.cc *.h *.hh *.hpp *.c *.loci *.lh Makefile Loci ; do
    if [ -f  $i ] ; then
      if [ ! -e $target/Loci/$dir/$i ] ; then
        echo ln -s $source/src/$dir/$i $target/Loci/$dir/$i
        ln -s $source/src/$dir/$i $target/Loci/$dir/$i
      fi
    fi
  done
done

for dir in $TOOLS_DIRS; do
  echo "Linking" $dir "directory files..."
  cd $source/$dir
  for i in *.cc *.h *.hh *.hpp *.c *.loci *.lh Makefile Loci ; do
    if [ -f  $i ] ; then
      if [ ! -e $target/Loci/$dir/$i ] ; then
        echo ln -s $source/$dir/$i $target/Loci/$dir/$i
        ln -s $source/$dir/$i $target/Loci/$dir/$i
      fi
    fi
  done
done

#echo "** Be sure to set LOCI_BASE=\"$target/Loci\" **"


